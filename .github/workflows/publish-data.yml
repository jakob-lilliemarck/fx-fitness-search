name: Publish Datasets

on:
  workflow_dispatch:

jobs:
  publish:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        dataset:
          - name: beijing-air-quality
            path: src/optimizations/beijing_air_quality/data
    steps:
      - uses: actions/checkout@v4

      - name: Archive ${{ matrix.dataset.name }} dataset
        run: tar -czf ${{ matrix.dataset.name }}.tar.gz -C $(dirname ${{ matrix.dataset.path }}) $(basename ${{ matrix.dataset.path }})/

      - name: Upload ${{ matrix.dataset.name }} to Releases
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh release create datasets-${{ matrix.dataset.name }} ${{ matrix.dataset.name }}.tar.gz --title "Dataset: ${{ matrix.dataset.name }}" --notes "Static dataset - never changes" || gh release upload datasets-${{ matrix.dataset.name }} ${{ matrix.dataset.name }}.tar.gz --clobber
